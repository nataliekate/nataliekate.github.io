{"data":{"site":{"siteMetadata":{"title":"Natalie's Blog","author":"nataliekate"}},"markdownRemark":{"id":"d59a1c85-be93-5fdc-8da5-0238a8e2de5b","excerpt":"来源：Santa Tracker as a PWA去年圣诞节才知道Google弄了个有趣的小应用，叫Santa Tracker，让你实时跟踪圣诞老人的“去向”。当时就觉得太好玩了。今天无聊看了下Google Developers的前端Case Studies…","html":"<p>来源：<a href=\"https://developers.google.com/web/showcase/2017/santa\">Santa Tracker as a PWA</a></p>\n<p>去年圣诞节才知道Google弄了个有趣的小应用，叫Santa Tracker，让你实时跟踪圣诞老人的“去向”。当时就觉得太好玩了。今天无聊看了下Google Developers的前端Case Studies，发现刚好有一篇关于这个小应用的文章，于是读了一下，希望能汲取大神们的智慧。</p>\n<p>Santa Tracker is an Progressive Web App (PWA) that supports Add to Home Screen (ATHS) and offline. The offline function makes use of the Service Worker API.</p>\n<p>The unique ‘scenes’ on the web version of Santa Tracker is written in <a href=\"https://www.polymer-project.org/\">Polymer</a>, supporting most modern browsers. The app requires ES6 features like <code class=\"language-text\">Set</code> as well as the <strong>Web Performance API</strong>. To decide whether the browser is <em>modern</em> enough to run Santa Tracker, this <a href=\"https://github.com/google/santa-tracker-web/blob/280183e37e30f16856e9c238cc6de613f4309fd1/index.html#L75\">code</a> will be executed.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> supported <span class=\"token operator\">=</span> ignoreCheck <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// feature-detect APIs: limits to IE11+, SF9+</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>performance <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>performance<span class=\"token punctuation\">.</span>now <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>window<span class=\"token punctuation\">.</span>Set <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>history<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// no older Android browser</span>\n  <span class=\"token keyword\">var</span> uaString <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>userAgent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>uaString<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Chrome'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> uaString<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Android'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token regex\">/^Google/</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>navigator<span class=\"token punctuation\">.</span>vendor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// no older Chromium (e.g., Samsung browser fork or ancient install)</span>\n  <span class=\"token keyword\">var</span> chromeVersion <span class=\"token operator\">=</span> <span class=\"token regex\">/Chrome\\/(\\d+)/</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>uaString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>chromeVersion <span class=\"token operator\">&amp;&amp;</span> chromeVersion<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>chromeVersion<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">44</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>supported<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// fail over to upgrade.html, falling back to timeout in case Analytics is failing.</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> <span class=\"token string\">'upgrade.html'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>query <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'send'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pageview'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'send'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'event'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Polymer'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'unsupported-browser'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> hitCallback<span class=\"token punctuation\">:</span> redirect <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  navigator<span class=\"token punctuation\">.</span>sendBeacon <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>redirect<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Challenges</h2>\n<p>The size of the Santa Tracker app is rather large, like serveral hundred megabytes large! This is for a few reasons:</p>\n<ul>\n<li>Many assets must be duplicated in order to support multiple languages</li>\n<li>Different media support for different platforms</li>\n<li>Different sizes and resolutions for multimedia files</li>\n</ul>","frontmatter":{"title":"Case Study：Google's Santa Tracker","date":"June 01, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/googles-santa-tracker/","previous":{"fields":{"slug":"/parseInt/"},"frontmatter":{"title":"Tricky parseInt()"}},"next":null}}